{% extends 'shop/base.html' %}
{% load static %}

{% block tittle %} Корзина {% endblock %}

{% block content-shop %}
<h1 style="text-align: center">Товары в корзине</h1>
<div class="container">
    <form method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-lg-6">
                <table class="table-prods">
                    <tbody>
                    {% for el in products_in_basket %}
                    <tr>
                        <td style="width: 120px;">
                            {% for ph in products_in_basket_ph %}
                            {% if el.product.id == ph.product.id %}
                            <img src="{{ ph.image.url }}" class="img-card">
                            {% endif %}
                            {% endfor %}
                        </td>
                        <td style="    position: relative">
                            <p style="position: absolute;top: 0%;left: 50%;transform: translateX(-50%);font-size: 20px;">
                                {{ el.product.name }}</p>


                            <!--                            <input class="product-in-basket-nmb" value="{{ el.nmb }}" type="number" id="number" -->
                            <!--                                   name="product_in_basket_el_{{ el.id }}">-->
                            <div class="number">
                                <div class="number">
                                    <button class="number-minus" type="button">-
                                    </button>
                                    <input class="product-in-basket-nmb" value="{{ el.nmb }}" type="number" id="number"
                                           name="product_in_basket_el_{{ el.id }}" min="0" readonly>
                                    <button class="number-plus" type="button">+</button>
                                </div>

                                <script>
                                    function changeValue(button, delta) {
                                        const $container = $(button).closest('.number');
                                        const $input = $container.find('input.product-in-basket-nmb');
                                        let currentValue = parseInt($input.val()) || 0;
                                        let newValue = currentValue + delta;
                                        const min = parseInt($input.attr('min')) || 0;
                                        if (newValue < min) newValue = min;
                                        $input.val(newValue).trigger('change');
                                    }
                                </script>
                            </div>

                            <span class="product-price hidden">
                                        {{ el.price_per_item }}
                                    </span>

                            <span class="total-product-in-basket-amount">
                                        {{ el.total_price }}$
                                    </span>
                        </td>
                    </tr>

                    {% endfor %}

                    </tbody>
                </table>
<br>
                <div class="text-right" style="text-align: right;">
                    <b>Сумма заказа: </b> <span id="total_order_amount"></span>$
                </div>
            </div>

            <div class="col-lg-6" style="position: relative">
                <div class="form-group" style="">
                    <table class="contact-table">
                        <tbody>
                        <tr>
                            <td>
                                <label>Имя</label>
                            </td>
                            <td>
                                <input type="Text" class="form-control" name="{{ form.user_name.html_name }}"
                                       value="{{user.first_name}}" maxlength="32">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Phone number</label>
                            </td>
                            <td>
                                <input type="text" class="form-control" value="{{user.phone_number}}"
                                       name="{{form.user_phone.html_name}}"
                                       id="user_phone">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>customer_address</label>
                            </td>
                            <td>
                                <input type="text" class="form-control" name="{{form.user_address.html_name}}"
                                       id="user_address">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>comments</label>
                            </td>
                            <td>
                                <input type="text" class="form-control" name="{{form.user_comment.html_name}}"
                                       id="user_comment">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>


            <div class="text-right" style="text-align: right;">
                <button type="submit" class="btn btn-primary btn-lg">Оформить заказ</button>
            </div>
        </div>
        {{ form.errors }}
    </form>


</div>
{% endblock %}
